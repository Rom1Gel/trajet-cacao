<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trajet Réaliste du Cacao</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #map { height: 80vh; }
    #timeline-container {
      height: 20vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: #f0f0f0;
      padding: 10px;
    }
    #timeSlider {
      width: 80%;
    }
    #dateDisplay {
      margin-bottom: 10px;
      font-size: 1.2em;
    }
    #timeLabels {
      width: 80%;
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="timeline-container">
    <div id="dateDisplay"></div>
    <input type="range" id="timeSlider" min="0" value="0">
    <div id="timeLabels">
      <span id="startLabel">14/10/2026</span>
      <span id="endLabel">18/11/2026</span>
    </div>
  </div>
  <script>
    // Initialisation de la carte
    var map = L.map('map').setView([15, 0], 3);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    // Définition de l'icône de la fève de cacao
    var cacaoIcon = L.icon({
      iconUrl: 'https://media.istockphoto.com/id/1425432280/fr/photo/cabosses-de-cacao-avec-des-feuilles-de-cacao-isol%C3%A9es-sur-fond-blanc.jpg?s=1024x1024&w=is&k=20&c=HigEa6cvUwwDN76R3fbH6PK-YYBQtjXosd2uOUJnQnQ=',
      iconSize: [32, 32],
      iconAnchor: [16, 16]
    });

    // Itinéraire détaillé simulant un trajet réaliste du cacao
    // Points successifs : Abidjan, San-Pédro, un point intermédiaire, Freetown, Dakar, Tenerife, Lisbonne, Marseille, Bruxelles.
    var route = [
      {lat: 5.345, lng: -4.008},         // 1. Abidjan, Côte d'Ivoire
      {lat: 4.456, lng: -6.380},         // 2. San-Pédro, Côte d'Ivoire
      {lat: 6.180, lng: -10.480},         // 3. Point intermédiaire en mer
      {lat: 8.4844, lng: -13.2344},       // 4. Freetown, Sierra Leone
      {lat: 14.7167, lng: -17.4677},      // 5. Dakar, Sénégal
      {lat: 28.2916, lng: -16.6291},      // 6. Tenerife, Îles Canaries (Espagne)
      {lat: 38.7223, lng: -9.1393},       // 7. Lisbonne, Portugal
      {lat: 43.2965, lng: 5.3698},        // 8. Marseille, France
      {lat: 50.8503, lng: 4.3517}         // 9. Bruxelles, Belgique
    ];

    // Définir la timeline à partir des dates réelles
    var startDate = new Date('2026-10-14T00:00:00');
    var endDate = new Date('2026-11-18T00:00:00');
    var totalDuration = endDate - startDate; // en millisecondes

    // On divise uniformément le temps sur les segments
    var segmentDuration = totalDuration / (route.length - 1);

    // Dessiner la polyline du trajet
    var polyline = L.polyline(route, {color: 'blue', weight: 4}).addTo(map);
    map.fitBounds(polyline.getBounds());

    // Placer le marqueur sur le point de départ
    var marker = L.marker(route[0], {icon: cacaoIcon}).addTo(map);

    // Afficher la date courante sur la timeline
    var dateDisplay = document.getElementById('dateDisplay');
    function updateDateDisplay(currentTime) {
      var currentDate = new Date(startDate.getTime() + currentTime);
      dateDisplay.textContent = currentDate.toLocaleString('fr-FR', {
        day: '2-digit', month: '2-digit', year: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    }
    updateDateDisplay(0);

    // Fonction d'interpolation linéaire
    function lerp(start, end, t) {
      return start + (end - start) * t;
    }

    // Mettre à jour la position du marqueur en fonction du temps écoulé (en ms)
    function updateMarker(currentTime) {
      // On s'assure que currentTime est dans [0, totalDuration]
      currentTime = Math.max(0, Math.min(currentTime, totalDuration));
      // Identifier le segment
      var segmentIndex = Math.floor(currentTime / segmentDuration);
      if (segmentIndex >= route.length - 1) {
        marker.setLatLng([route[route.length - 1].lat, route[route.length - 1].lng]);
        return;
      }
      var t = (currentTime - segmentIndex * segmentDuration) / segmentDuration;
      var startPoint = route[segmentIndex];
      var endPoint = route[segmentIndex + 1];
      var currentLat = lerp(startPoint.lat, endPoint.lat, t);
      var currentLng = lerp(startPoint.lng, endPoint.lng, t);
      marker.setLatLng([currentLat, currentLng]);
    }

    // Gestion du slider
    var timeSlider = document.getElementById('timeSlider');
    timeSlider.min = 0;
    timeSlider.max = totalDuration;
    timeSlider.addEventListener('input', function() {
      var currentTime = parseInt(this.value, 10);
      updateMarker(currentTime);
      updateDateDisplay(currentTime);
    });

    // Animation automatique (facultative)
    var animationStartTime = null;
    function animateMarker(timestamp) {
      if (!animationStartTime) animationStartTime = timestamp;
      var elapsed = timestamp - animationStartTime;
      if (elapsed > totalDuration) elapsed = totalDuration;
      timeSlider.value = elapsed;
      updateMarker(elapsed);
      updateDateDisplay(elapsed);
      if (elapsed < totalDuration) {
        requestAnimationFrame(animateMarker);
      }
    }
    // Pour désactiver l'animation automatique (laisser le contrôle à l'utilisateur),
    // commentez la ligne suivante :
    // requestAnimationFrame(animateMarker);
  </script>
</body>
</html>
